---
import type { CollectionEntry } from "astro:content";

interface Props {
    link: CollectionEntry<"links">;
}

const { link } = Astro.props;
const { data } = link;

const sizeClasses: Record<string, string> = {
    small: "col-span-1 md:col-span-1",
    "medium-wide": "col-span-1 md:col-span-2",
    "medium-tall": "col-span-1 md:row-span-2",
    large: "col-span-1 md:col-span-2 md:row-span-2",
    // 1. FULL WIDTH: Spans the entire container (Great for a footer or banner)
    "full-width": "col-span-1 md:col-span-3",

    // 2. TOWER: Very tall, thin card (Great for a vertical timeline or vertical text)
    tower: "col-span-1 md:row-span-3",
};

// OPTION 3 PALETTE: All Dark, Distinction via Borders & Text
const styleClasses: Record<string, string> = {
    // Standard: Dark Grey, Subtle White Border. Hover = Gold Border.
    default:
        "bg-[#1a1a1a] border-white/10 hover:border-[#F5C265]/50 text-white",

    // Emphasis: Dark Grey, GOLD Border permanently.
    accent: "bg-[#1a1a1a] border-[#F5C265]/60 hover:border-[#F5C265] text-white shadow-2xl shadow-[#F5C265]/5",

    // Hero: Dark Grey, Subtle Gradient.
    hero: "bg-gradient-to-br from-[#1a1a1a] to-[#2A1B3D] border-white/10 hover:border-[#F5C265]/50 text-white",

    // 1. GLASS: Frosted look, great for media or images underneath
    glass: "bg-white/5 backdrop-blur-lg border-white/10 text-white hover:bg-white/10 hover:border-white/20",

    // 2. TERMINAL: Tech-focused, monospaced vibe (Good for Github/Code)
    terminal:
        "bg-[#0a0a0a] border-white/10 text-[#F5C265] font-mono hover:border-[#F5C265]/50",

    // 3. SOLID GOLD: High contrast, black text (Use sparingly for "Buy" buttons)
    solid: "bg-[#F5C265] border-[#F5C265] text-black hover:bg-white hover:border-white",

    // 4. MESH: A subtle top-right spotlight gradient (Good for 'Featured' content)
    mesh: "bg-[radial-gradient(ellipse_at_top_right,_var(--tw-gradient-stops))] from-[#1a1a1a] via-[#1a1a1a] to-[#514d28] border-white/10 text-white",

    // 5. MINIMAL: No background, just text. (Good for simple lists)
    minimal:
        "bg-transparent border-white/10 text-gray-500 hover:text-[#F5C265] hover:border-[#F5C265]/50 hover:translate-x-1",
};
---

<a
    href={data.url}
    target={data.url.startsWith("http") ? "_blank" : "_self"}
    rel={data.url.startsWith("http") ? "noopener noreferrer" : undefined}
    class={`bento-card group relative flex flex-col justify-between overflow-hidden rounded-xl border p-4 transition-all duration-500 hover:shadow-2xl hover:shadow-[#F5C265]/10 gap-3 ${sizeClasses[data.bentoSize]} ${styleClasses[data.style]}`}
>
    {
        data.image && (
            <div class="absolute inset-0 z-0">
                <img
                    src={data.image}
                    alt={data.label}
                    class="h-full w-full object-cover opacity-40 transition-opacity duration-500 group-hover:opacity-20 mix-blend-overlay"
                />
                <div class="absolute inset-0 bg-gradient-to-t from-[#1a1a1a] via-[#1a1a1a]/80 to-transparent" />
            </div>
        )
    }

    <div class="relative z-10 flex flex-col gap-2">
        <div class="flex items-center gap-2">
            {
                data.icon && (
                    <div
                        class={`flex h-6 w-6 items-center justify-center rounded bg-[#2a2a2a] transition-colors group-hover:bg-[#F5C265]/20`}
                    >
                        <span class="font-bebas text-xs tracking-widest opacity-80 text-gray-300 group-hover:text-[#F5C265]">
                            {data.icon.substring(0, 2)}
                        </span>
                    </div>
                )
            }
            <h3
                class="font-bebas text-xl uppercase tracking-wide leading-none text-white"
            >
                {data.label}
            </h3>
        </div>

        {
            data.description && (
                <p class="font-sans text-xs leading-relaxed max-w-[95%] text-gray-400 group-hover:text-white/90 transition-colors line-clamp-2">
                    {data.description}
                </p>
            )
        }
    </div>

    <div class="relative z-10 flex items-end justify-between mt-2">
        <span
            class={`text-[10px] font-bold uppercase tracking-[0.25em] transition-colors ${
                data.style === "hero"
                    ? "text-[#F5C265]"
                    : "text-gray-500 group-hover:text-[#F5C265]"
            }`}
        >
            {data.style === "hero" ? "START HERE" : "LINK"}
        </span>

        <div
            class={`flex items-center gap-1.5 rounded px-2.5 py-1 text-[10px] font-bold uppercase tracking-wider transition-all border border-transparent hover:-translate-y-0.5 opacity-0 group-hover:opacity-100 duration-300 
        ${data.style === "accent" ? "bg-[#F5C265] text-black hover:bg-white hover:text-black hover:shadow-lg hover:shadow-[#F5C265]/20" : "bg-[#2a2a2a] text-gray-300 border-white/10 group-hover:border-[#F5C265] hover:bg-[#F5C265] hover:text-black hover:shadow-lg hover:shadow-[#F5C265]/20"}`}
        >
            <span>Open</span>
            <svg
                class="h-2.5 w-2.5 transition-transform duration-300 group-hover:-translate-y-0.5 group-hover:translate-x-0.5"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
            >
                <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M7 17L17 7M17 7H7M17 7V17"></path>
            </svg>
        </div>
    </div>

    <div
        class="pointer-events-none absolute -inset-px opacity-0 transition-opacity duration-300 group-hover:opacity-100"
        style="background: radial-gradient(600px circle at var(--x) var(--y), rgba(245, 194, 101, 0.06), transparent 40%);"
    >
    </div>
</a>

<script>
    function initCards() {
        // Simple scale effect is handled by CSS (hover:scale), but we keep the spotlight effect here
        const cards = document.querySelectorAll(".bento-card");
        cards.forEach((element) => {
            const card = element as HTMLElement;
            card.addEventListener("mousemove", (e: MouseEvent) => {
                const rect = card.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                card.style.setProperty("--x", `${x}px`);
                card.style.setProperty("--y", `${y}px`);
            });
        });
    }
    initCards();
    document.addEventListener("astro:after-swap", initCards);
</script>
